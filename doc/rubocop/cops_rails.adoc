////
  Do NOT edit this file by hand directly, as it is automatically generated.

  Please make any necessary changes to the cop documentation within the source files themselves.
////

= Rails

[#railsavoidtimecomparison]
== Rails/AvoidTimeComparison

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Checks for time comparison.
For more information see: https://gitlab.com/gitlab-org/gitlab/-/merge_requests/133520

[#examples-railsavoidtimecomparison]
=== Examples

[source,ruby]
----
# bad
datetime > Time.now
Time.current < datetime
datetime > Time.zone.now

# good
datetime.future?
datetime.future?
datetime.past?
----

[#railsmigrationtimestamp]
== Rails/MigrationTimestamp

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Checks to ensure timestamp used for a migration file occurs in the past.
If it is not in the past, this can cause Rails to enumerate the file names until that date has passed.
For instance if the migration below exists:
  30000220000000_some_migration.rb
It will cause rails generator to create new migrations as an enumeration on that timestamp until 30000220 has
passed. We would be generating files like this:
  30000220000001_some_migration.rb
  30000220000002_some_migration.rb
That methodology increases the probability of collision with others contributing at the same time
as each file is merely enumerated by 1.

[#examples-railsmigrationtimestamp]
=== Examples

[source,ruby]
----
# bad - date is in the future
30000220000000_some_migration.rb

# good - date is in the past
20240219000000_some_migration.rb
----

[#railsstrongparams]
== Rails/StrongParams

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

Cop that detects passing params as an argument without making them
StrongParams first. Used to reduce the likelihood of input
validation errors outside of ActiveModel. E.g. when a parameter
is an array of strings instead of a single string, and that gets
passed to a Service or Helper method.

This cop has an "unsafe" AutoCorrect for simple key access. It is
unsafe in that "it produces code that's mostly equivalent to the
original code, but not 100% equivalent".
In all other cases a manual correction is required.

[#examples-railsstrongparams]
=== Examples

[source,ruby]
----
# bad - find_by will check an array of values until one returns
PersonalAccessToken.find_by(token: params[:token])
# good - the example above can be automatically corrected to
PersonalAccessToken.find_by(token: params.permit(:token)[:token])

# bad - otp_code might be an array
MfaValidatorService.new(current_user).execute(params[:otp_code])

# bad - technically OK but better to use StrongParams
MfaValidatorService.new(current_user).execute(params[:otp_code].to_s)

# bad - usually safe, but better to use StrongParams
paginated_resource.page(params[:page]).per(params[:per_page])

# bad - explicitly permit named parameters instead of allowing anything
MfaValidatorService.new(current_user).execute(params.permit![:otp_code])

# good - using permit inline
MfaValidatorService.new(current_user).execute(params.permit(:otp_code)[:otp_code])

# good - using permit via a helper method
def otp_params
  params.permit(:otp_code)
end
MfaValidatorService.new(current_user).execute(otp_params[:otp_code])

# good - using require and permit
User.find_by(email: params.require(:user).permit(:email)[:email])
----
