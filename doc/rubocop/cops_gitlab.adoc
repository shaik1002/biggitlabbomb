////
  Do NOT edit this file by hand directly, as it is automatically generated.

  Please make any necessary changes to the cop documentation within the source files themselves.
////

= Gitlab

[#gitlabavoidcurrentorganization]
== Gitlab/AvoidCurrentOrganization

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop checks for use Current.organization at banned layers of the application

# bad
class SomeService
  def execute
    do_something_with(Current.organization)
  end
end

# good
class SomeController < ApplicationController
  def create
    response = SomeService.new(organization: Current.organization).execute
  end
end

class SomeService
  def initialize(organization:)
    @organization = organization
  end

  def execute
    do_something_with(@organization)
  end
end

[#gitlabavoidfeaturecategorynotowned]
== Gitlab/AvoidFeatureCategoryNotOwned

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabavoidfeatureget]
== Gitlab/AvoidFeatureGet

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Bans the use of `Feature.get`.

# bad

Feature.get(:x).enable
Feature.get(:x).enable_percentage_of_time(100)
Feature.get(:x).remove

# good

stub_feature_flags(x: true)
Feature.enable(:x)
Feature.enable_percentage_of_time(:x, 100)
Feature.remove(:x)

[#gitlabavoidgitlabinstancechecks]
== Gitlab/AvoidGitlabInstanceChecks

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop checks for use of gitlab instance specific checks.

[#examples-gitlabavoidgitlabinstancechecks]
=== Examples

[source,ruby]
----
# bad
if Gitlab.com?
  Ci::Runner::FORM_EDITABLE + Ci::Runner::MINUTES_COST_FACTOR_FIELDS
else
  Ci::Runner::FORM_EDITABLE
end

# good
if Gitlab::Saas.feature_available?(:purchases_additional_minutes)
  Ci::Runner::FORM_EDITABLE + Ci::Runner::MINUTES_COST_FACTOR_FIELDS
else
  Ci::Runner::FORM_EDITABLE
end
----

[#gitlabavoiduploadedfilefromparams]
== Gitlab/AvoidUploadedFileFromParams

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop checks for `UploadedFile.from_params` usage.
See https://docs.gitlab.com/ee/development/uploads/working_with_uploads.html

[#examples-gitlabavoiduploadedfilefromparams]
=== Examples

[source,ruby]
----
# bad
class MyAwfulApi < Grape::API::Instance
  params do
    optional 'file.path', type: String
    optional 'file.name', type: String
    optional 'file.type', type: String
    optional 'file.size', type: Integer
    optional 'file.md5', type: String
    optional 'file.sha1', type: String
    optional 'file.sha256', type: String
  end
  put '/files' do
    uploaded_file = UploadedFile.from_params(params, :file, FileUploader.workhorse_local_upload_path)
  end
end

# good
class MyMuchBetterApi < Grape::API::Instance
  params do
    requires :file, type: ::API::Validations::Types::WorkhorseFile
  end
  put '/files' do
    uploaded_file = declared_params[:file]
  end
end
----

[#gitlabboundedcontexts]
== Gitlab/BoundedContexts

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabbulkinsert]
== Gitlab/BulkInsert

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that disallows the use of `legacy_bulk_insert`, in favour of using
the `BulkInsertSafe` module.

[#gitlabchangetimezone]
== Gitlab/ChangeTimezone

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabconstgetinheritfalse]
== Gitlab/ConstGetInheritFalse

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

Cop that encourages usage of inherit=false for 2nd argument when using const_get.

See https://gitlab.com/gitlab-org/gitlab/issues/27678

[#gitlabdelegatepredicatemethods]
== Gitlab/DelegatePredicateMethods

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop looks for delegations to predicate methods with `allow_nil: true` option.
This construct results in three possible results: true, false and nil.
In other words, it does not preserve the strict Boolean nature of predicate method return value.
This cop suggests creating a method to handle `nil` delegator and ensure only Boolean type is returned.

[#examples-gitlabdelegatepredicatemethods]
=== Examples

[source,ruby]
----
# bad
delegate :is_foo?, to: :bar, allow_nil: true

# good
def is_foo?
  return false unless bar
  bar.is_foo?
end

def is_foo?
  !!bar&.is_foo?
end
----

[#gitlabdocurl]
== Gitlab/DocUrl

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop encourages using helper to link to documentation
in string literals.

[#examples-gitlabdocurl]
=== Examples

[source,ruby]
----
# bad
'See [the docs](https://docs.gitlab.com/ee/user/permissions#roles).'
_('See [the docs](https://docs.gitlab.com/ee/user/permissions#roles).')

# good
docs_link = link_to _('the docs'), help_page_url('user/permissions.md', anchor: 'roles')
"See #{docs_link}."
_('See %{docs_link}.').html_safe % { docs_link: docs_link.html_safe }
----

[#gitlabeeonlyclass]
== Gitlab/EeOnlyClass

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabeventstoresubscriber]
== Gitlab/EventStoreSubscriber

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that checks the implementation of Gitlab::EventStore::Subscriber

A worker that implements Gitlab::EventStore::Subscriber
must implement the method #handle_event(event) and
must not override the method #perform(*args)

 # bad
 class MySubscriber
   include Gitlab::EventStore::Subscriber

   def perform(*args)
   end
 end

 # bad
 class MySubscriber
   include Gitlab::EventStore::Subscriber
 end

 # good
 class MySubscriber
   include Gitlab::EventStore::Subscriber

   def handle_event(event)
   end
 end

[#gitlabexcept]
== Gitlab/Except

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that disallows the use of `Gitlab::SQL::Except`, in favour of using
the `FromExcept` module.

[#gitlabfeatureavailableusage]
== Gitlab/FeatureAvailableUsage

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that checks for correct calling of #feature_available?

[#gitlabfeatureflagwithoutactor]
== Gitlab/FeatureFlagWithoutActor

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabfinderwithfindby]
== Gitlab/FinderWithFindBy

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

No documentation

[#gitlabhttparty]
== Gitlab/HTTParty

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

No documentation

[#gitlabintersect]
== Gitlab/Intersect

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that disallows the use of `Gitlab::SQL::Intersect`, in favour of using
the `FromIntersect` module.

[#gitlabjson]
== Gitlab/Json

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

No documentation

[#gitlabkeysfirstandvaluesfirst]
== Gitlab/KeysFirstAndValuesFirst

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

Detects the use of `.keys.first` or `.values.first` and suggests a
change to `.each_key.first` or `.each_value.first`. This reduces
memory usage and execution time.

# bad

hash.keys.first
hash.values.first

# good

hash.each_key.first
hash.each_value.first

[#gitlablicenseavailableusage]
== Gitlab/LicenseAvailableUsage

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop to ban use of License.feature_available? in ApplicationSetting model to avoid cyclical dependency issues.
Issue example: https://gitlab.com/gitlab-org/gitlab/-/issues/423237

[#gitlabmarkusedfeatureflags]
== Gitlab/MarkUsedFeatureFlags

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop tracks the usage of feature flags among the codebase.

The files set in `tmp/feature_flags/*.used` can then be used for verification purpose.

[#gitlabmodulewithinstancevariables]
== Gitlab/ModuleWithInstanceVariables

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabnamespacedclass]
== Gitlab/NamespacedClass

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that enforces use of namespaced classes in order to better identify
high level domains within the codebase.

[#examples-gitlabnamespacedclass]
=== Examples

[source,ruby]
----
# bad
class MyClass
end

module Gitlab
  class MyClass
  end
end

class Gitlab::MyClass
end

# good
module MyDomain
  class MyClass
  end
end

module Gitlab
  module MyDomain
    class MyClass
    end
  end
end

class Gitlab::MyDomain::MyClass
end
----

[#gitlabnocodecoveragecomment]
== Gitlab/NoCodeCoverageComment

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Discourages the use of `# :nocov:` to exclude code from coverage report.

The nocov token can be configured via `CommentToken` option and defaults
to `'nocov'`.

[#examples-gitlabnocodecoveragecomment]
=== Examples

[#commenttoken_-_nocov_-_default_-gitlabnocodecoveragecomment]
==== CommentToken: 'nocov' (default)

[source,ruby]
----
# bad
# :nocov:
def method
end
# :nocov:

# good
def method
end
----

[#gitlabnofindinworkers]
== Gitlab/NoFindInWorkers

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Checks for use of ActiveRecord find in Sidekiq workers.

[#examples-gitlabnofindinworkers]
=== Examples

[source,ruby]
----
# bad
class ExampleWorker
  def perform
    record = Klass.find(id)
  end
end

# good
class ExampleWorker
  def perform
    record = Klass.find_by_id(id)
    return unless record
  end
end
----

[#gitlabpolicyruleboolean]
== Gitlab/PolicyRuleBoolean

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

This cop checks for usage of boolean operators in rule blocks, which
does not work because conditions are objects, not booleans.

# bad, `conducts_electricity` returns a Rule object, not a boolean!
rule { conducts_electricity && batteries }.enable :light_bulb

# good
rule { conducts_electricity & batteries }.enable :light_bulb

# bad, `conducts_electricity` returns a Rule object, so the ternary is always going to be true
rule { conducts_electricity ? can?(:magnetize) : batteries }.enable :motor

# good
rule { conducts_electricity & can?(:magnetize) }.enable :motor
rule { ~conducts_electricity & batteries }.enable :motor

[#gitlabpredicatememoization]
== Gitlab/PredicateMemoization

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabrailslogger]
== Gitlab/RailsLogger

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabserviceresponse]
== Gitlab/ServiceResponse

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

No documentation

[#gitlabstrongmemoizeattr]
== Gitlab/StrongMemoizeAttr

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| Always
| -
| -
|===

Prefer using `.strong_memoize_attr()` over `#strong_memoize()`. See
https://docs.gitlab.com/ee/development/utilities.html/#strongmemoize.

Good:

    def memoized_method
      'This is a memoized method'
    end
    strong_memoize_attr :memoized_method

Bad, can be autocorrected:

    def memoized_method
      strong_memoize(:memoized_method) do
        'This is a memoized method'
      end
    end

Very bad, can't be autocorrected:

    def memoized_method
      return unless enabled?

      strong_memoize(:memoized_method) do
        'This is a memoized method'
      end
    end

[#gitlabtokenwithoutprefix]
== Gitlab/TokenWithoutPrefix

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Checks for the use of add_authentication_token_field without
also defining a prefix. Using a prefix for each token type
allows easier secret detection if it leaks.

[#examples-gitlabtokenwithoutprefix]
=== Examples

[source,ruby]
----
# bad
add_authentication_token_field :foo

# good
add_authentication_token_field :foo, format_with_prefix: method_name_here
----

[#gitlabunion]
== Gitlab/Union

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that disallows the use of `Gitlab::SQL::Union`, in favour of using
the `FromUnion` module.

[#gitlabwithoutreactivecache]
== Gitlab/WithoutReactiveCache

|===
| Enabled by default | Safe | Supports autocorrection | Version Added | Version Changed

| Enabled
| Yes
| No
| -
| -
|===

Cop that prevents the use of `without_reactive_cache`
